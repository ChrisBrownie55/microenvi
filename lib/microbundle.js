function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var n=e(require("rollup-plugin-flow"));require("acorn-jsx");var t=e(require("fs")),r=require("path"),i=e(require("chalk")),u=require("asyncro"),s=e(require("es6-promisify")),o=e(require("glob")),c=e(require("autoprefixer")),a=require("rollup"),l=e(require("rollup-plugin-nodent")),p=e(require("rollup-plugin-commonjs")),d=e(require("rollup-plugin-node-resolve")),f=e(require("rollup-plugin-buble")),h=e(require("rollup-plugin-uglify")),m=e(require("rollup-plugin-postcss")),g=e(require("rollup-plugin-strict-alias")),v=e(require("gzip-size")),b=e(require("pretty-bytes")),y=e(require("rollup-plugin-preserve-shebang")),w=e(require("rollup-plugin-typescript")),j=e(require("camelcase"));function x(e){var t=n(e);return Object.assign({},t,{transform:function(e,n){var r=t.transform(e,n);return r&&r.code===e?null:r}})}var _=s(t.readFile),q=s(t.stat),O=function(e){return q(e).then(function(e){return e.isDirectory()}).catch(function(){return!1})},k=function(e){return q(e).then(function(e){return e.isFile()}).catch(function(){return!1})},A=function(e){return e.replace(/^@.*\//,"")},P=function(e){return j(A(e).toLowerCase().replace(/((^[^a-zA-Z]+)|[^\w.-])|([^a-zA-Z0-9]+$)/g,""))},z={exclude:"node_modules/**"};function E(e){return new Promise(function(n,t){var s,c,l,p,d,f,h,m,g,y;function w(e,n){return new Promise(function(t,u){var s,o,c;return v(e).then(function(e){try{return o=b(s=e),c=s<5e3?"green":s>4e4?"red":"yellow",t(""+" ".repeat(10-o.length)+i[c](o)+": "+i.white(r.basename(n)))}catch(e){return u(e)}}.bind(this),u)}.bind(this))}l=e.cwd=r.resolve(process.cwd(),e.cwd),p=!0;var j=function(){var v=this;try{return e.pkg.name||(e.pkg.name=r.basename(e.cwd),p&&process.stderr.write(i.yellow(i.yellow.inverse("WARN")+' missing package.json "name" field. Assuming "'+e.pkg.name+'".')+"\n")),s=function(e){return new Promise(function(n,t){return k(r.resolve(l,e+".ts")).then(function(i){try{return n(r.resolve(l,e+(i?".ts":".js")))}catch(e){return t(e)}}.bind(this),t)}.bind(v))},e.input=[],new Promise(function(n,t){return e.entries&&e.entries.length?n(e.entries):new Promise(function(n,t){var i;return new Promise(function(n,t){var i;if(!(i=e.pkg.source))return new Promise(function(e,n){var t;return O(r.resolve(l,"src")).then(function(r){try{if(t=r)return s("src/index").then(function(e){try{return t=e,i.call(this)}catch(e){return n(e)}}.bind(this),n);function i(){return e(t)}return i.call(this)}catch(e){return n(e)}}.bind(this),n)}.bind(this)).then(function(e){try{return i=e,u.call(this)}catch(e){return t(e)}}.bind(this),t);function u(){return n(i)}return u.call(this)}.bind(this)).then(function(e){try{if(!(i=e))return s("index").then(function(e){try{return i=e,r.call(this)}catch(e){return t(e)}}.bind(this),t);function r(){return n(i)}return r.call(this)}catch(e){return t(e)}}.bind(this),t)}.bind(this)).then(function(r){try{return n(r||e.pkg.module)}catch(e){return t(e)}}.bind(this),t)}.bind(this)).then(function(s){try{return[].concat(s).map(function(e){return o.sync(r.resolve(l,e))}).forEach(function(n){return(t=e.input).push.apply(t,n);var t}),d=r.resolve(l,e.output||e.pkg.main||"dist"),new Promise(function(e,n){var t;if(!(t=!d.match(/\.[a-z]+$/)))return O(d).then(function(e){try{return t=e,r.call(this)}catch(e){return n(e)}}.bind(this),n);function r(){return e(t)}return r.call(this)}.bind(this)).then(function(s){var o=this;try{return s&&(d=r.resolve(d,A(e.pkg.name)+".js")),e.output=d,u.map([].concat(e.input),function(e){return new Promise(function(n,t){return e=r.resolve(l,e),O(e).then(function(i){try{return i&&(e=r.resolve(e,"index.js")),n(e)}catch(e){return t(e)}}.bind(this),t)}.bind(o))}).then(function(s){var o=this;try{f=s.filter(function(e,n,t){return t.indexOf(e)===n}),e.entries=f,e.multipleEntries=f.length>1,(h=(e.format||e.formats).split(",")).sort(function(e,n){return"cjs"===e?-1:e>n?1:0}),m=[];for(var p=0;p<f.length;p++)for(var d=0;d<h.length;d++)m.push(N(e,f[p],h[d],0===p&&0===d));return e.watch?(c=e.onBuild,n(new Promise(function(n,t){process.stdout.write(i.blue("Watching source, compiling to "+r.relative(l,r.dirname(e.output))+":\n")),m.map(function(e){a.watch(Object.assign({output:e.outputOptions,watch:z},e.inputOptions)).on("event",function(n){if("ERROR"===n.code||"FATAL"===n.code)return t(n);"END"===n.code&&(w(e._code,e.outputOptions.file).then(function(e){process.stdout.write("Wrote "+e.trim()+"\n")}),"function"==typeof c&&c(n))})})}))):u.series(m.map(function(e){var n=e.inputOptions,t=e.outputOptions;return function(){return new Promise(function(e,r){var i;return n.cache=g,a.rollup(n).then(function(n){try{return g=i=n,i.write(t).then(function(n){try{return w(i._code,t.file).then(e,r)}catch(e){return r(e)}}.bind(this),r)}catch(e){return r(e)}}.bind(this),r)}.bind(o))}})).then(function(u){try{return y=u,n(i.blue("Build output to "+(r.relative(l,r.dirname(e.output))||".")+":")+"\n   "+y.join("\n   "))}catch(e){return t(e)}}.bind(this),t)}catch(e){return t(e)}}.bind(this),t)}catch(e){return t(e)}}.bind(this),t)}catch(e){return t(e)}}.bind(this),t)}catch(e){return t(e)}}.bind(this),x=function(n){try{process.stderr.write(i.yellow(i.yellow.inverse("WARN")+' no package.json found. Assuming a name of "'+r.basename(e.cwd)+'".')+"\n");var u=String(n.message||n);return u.match(/ENOENT/)||console.warn("  "+i.red.dim(u)),e.pkg={},p=!1,j()}catch(e){return t(e)}}.bind(this);try{return _(r.resolve(l,"package.json"),"utf8").then(function(n){try{return e.pkg=JSON.parse(n),j()}catch(e){return x(e)}}.bind(this),x)}catch(e){x(e)}}.bind(this))}function N(e,n,i,u){var s=e.pkg,o=["dns","fs","path","url"].concat(Object.keys(s.peerDependencies||{}),e.entries.filter(function(e){return e!==n})),a={};e.multipleEntries&&(a["."]="./"+r.basename(e.output),o.push("."));var v=!0;"all"===e.inline?v=!0:"all"!==e.external&&"none"!==e.inline||(v=!1,o=o.concat(Object.keys(s.dependencies)));var b=o.reduce(function(e,n){return n.match(/^[a-z_$][a-z0-9_$]*$/)&&(e[n]=n),e},{});function j(e,n){return r.resolve(r.dirname(e),n+r.basename(e).replace(/^[^.]+/,""))}var _=e.output;if(e.multipleEntries){var q=n.match(/(\\|\/)index(\.(umd|cjs|es|m))?\.js$/)?_:n;_=r.resolve(r.dirname(_),r.basename(q))}_=_.replace(/(\.(umd|cjs|es|m))?\.js$/,"");var O,k=j(s.module&&!s.module.match(/src\//)?s.module:s["jsnext:main"]||"x.m.js",_),A=j(s["cjs:main"]||"x.js",_),z=j(s["umd:main"]||"x.umd.js",_),E={},N=e.pkg.mangle||!1;if("es"!=i)try{var $=t.readFileSync(n,"utf-8"),R=/\bexport\s*default\s*[a-zA-Z_$]/.test($),S=/\bexport\s*(let|const|var|async|function\*?)\s*[a-zA-Z_$*]/.test($)||/^\s*export\s*\{/m.test($);R&&S&&(O="default")}catch(e){}var F=".ts"===r.extname(n),T={inputOptions:{input:O?r.resolve(__dirname,"../src/lib/__entry__.js"):n,external:o,plugins:[].concat(g({__microbundle_entry__:n}),m({plugins:[c()],inject:!1,extract:!!u}),F&&w({typescript:require("typescript")}),!F&&x({all:!0,pretty:!0}),l({exclude:"node_modules/**",noRuntime:!0,promises:!0,transformations:{forOf:!1},parser:{plugins:{jsx:!0}}}),!F&&f({exclude:"node_modules/**",jsx:e.jsx||"h",objectAssign:e.assign||"Object.assign",transforms:{dangerousForOf:!0,dangerousTaggedTemplateString:!0}}),v&&p({include:"node_modules/**"}),v&&d({module:!0,jsnext:!0,browser:"node"!==e.target}),!1!==e.compress&&[h({output:{comments:!1},compress:{keep_infinity:!0,pure_getters:!0},warnings:!0,ecma:5,toplevel:"cjs"===i||"es"===i,mangle:{properties:!!N&&{regex:N.regex?new RegExp(N.regex):null,reserved:N.reserved||[]}},nameCache:E}),N&&{options:function(){try{E=JSON.parse(t.readFileSync(r.resolve(e.cwd,"mangle.json"),"utf8"))}catch(e){}},onwrite:function(){u&&E&&t.writeFile(r.resolve(e.cwd,"mangle.json"),JSON.stringify(E,null,2),Object)}}],{ongenerate:function(e,n){var t=e.bundle,r=n.code;T._code=t._code=r}},y()).filter(Boolean)},outputOptions:{exports:O?"default":void 0,paths:a,globals:b,strict:!0===e.strict,legacy:!0,freeze:!1,sourcemap:!0,treeshake:{propertyReadSideEffects:!1},format:i,name:e.name||s.amdName||P(s.name),file:r.resolve(e.cwd,"es"===i&&k||"umd"===i&&z||A)}};return T}module.exports=E;
//# sourceMappingURL=microbundle.js.map
